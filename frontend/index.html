<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Katalog Buku</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-4">
  <h2 class="mb-4 text-center">ðŸ“š Katalog Buku</h2>

  <!-- Form Tambah Buku -->
  <div class="card p-4 mb-4">
    <h4>Tambah Buku</h4>
    <div class="row">
      <div class="col-md-6">
        <label>Judul Buku</label>
        <input type="text" id="title" class="form-control" placeholder="Masukkan judul buku">
      </div>
      <div class="col-md-3">
        <label>Stok</label>
        <input type="number" id="stock" class="form-control" placeholder="Stok (>0)">
      </div>
      <div class="col-md-3 d-flex align-items-end">
        <button class="btn btn-primary w-100" onclick="addBook()">Tambah</button>
      </div>
    </div>
  </div>

  <!-- Daftar Buku -->
  <div class="card p-4">
    <h4>Daftar Buku</h4>

    <table class="table table-bordered mt-3">
      <thead class="table-dark">
        <tr>
          <th>ID</th>
          <th>Judul</th>
          <th>Stok</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="bookList"></tbody>
    </table>
  </div>
</div>

<script>
const API = "http://localhost:3000";

// ðŸ”¹ Ambil daftar buku saat halaman dibuka
window.onload = loadBooks;

function loadBooks() {
  fetch(`${API}/books`)
    .then(res => res.json())
    .then(data => {
      let list = "";
      data.forEach(b => {
        list += `
          <tr>
            <td>${b.id}</td>
            <td>${b.title}</td>
            <td>${b.stock}</td>
            <td>${b.status}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick="updateStock(${b.id})">Update Stok</button>
              <button class="btn btn-success btn-sm" onclick="confirmBook(${b.id})">Konfirmasi</button>
            </td>
          </tr>
        `;
      });
      document.getElementById("bookList").innerHTML = list;
    });
}

// ðŸ”¹ Tambah buku
function addBook() {
  const title = document.getElementById("title").value;
  const stock = document.getElementById("stock").value;

  fetch(`${API}/books`, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ title, stock })
  })
  .then(res => res.json())
  .then(() => {
    alert("Buku ditambahkan!");
    loadBooks();
  });
}

// ðŸ”¹ Update stok
function updateStock(id) {
  const newStock = prompt("Masukkan stok baru (>0):");
  if (!newStock || newStock <= 0) return alert("Stok tidak valid!");

  fetch(`${API}/books/${id}`, {
    method: "PUT",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ stock: Number(newStock) })
  })
  .then(res => res.json())
  .then(() => {
    alert("Stok diperbarui!");
    loadBooks();
  });
}

// ðŸ”¹ Konfirmasi pesanan
function confirmBook(id) {
  fetch(`${API}/books/confirm/${id}`, { method: "PUT" })
    .then(res => res.json())
    .then(() => {
      alert("Pesanan dikonfirmasi!");
      loadBooks();
    });
}
</script>

</body>
</html>
